define("event-parkingpass-model",["foobunny","global_context"],function(a,b){"use strict";var c=a.BaseModel.extend({defaults:{parkingEventId:null,qty:1,sectionName:"",price:null,priceType:"listingPrice",deliveryDate:"",deliveryTypeList:"",parkingAdded:!1,listingExpired:!1},initialize:function(){this.key="parkingModel",this.urlHeaders=b.url_headers||{}},url:function(){var a=this.get("parkingEventId"),b=this.get("qty")||1,c=this.get("priceType");return"/shape/search/inventory/v2/listings?eventId="+a+"&start=0&rows=3&quantity="+b+"&sort=price+asc&priceType="+c},parse:function(a){return a.hasOwnProperty("listing")&&a.listing.length>1&&(a.alternateListings=_.clone(a.listing),a.alternateListings.shift()),a}});return c}),define("event-singlelisting-model",["foobunny","global_context"],function(a,b){"use strict";var c=a.BaseModel.extend({defaults:{parkingListingId:""},initialize:function(){this.urlHeaders=b.url_headers||{},this.key="parkingSingleListingModel"},loadMockData:function(){return this.url="parkingpass.json",this.urlHeaders={},this.fetch()},parse:function(a){var c,d,e=a,f=[17,22],g=e.deliveryMethods;if("undefined"!=typeof g&&g.length){for(var h=0;h<g.length;h++)g[h].id&&_.indexOf(f,g[h].id)===-1&&(e.deliveryDate?(c=new Date(e.deliveryDate).getTime(),d=new Date(g[h].estimatedDeliveryTime).getTime(),d>c&&(e.deliveryDate=g[h].estimatedDeliveryTime,e.deliveryDescription=g[h].name)):(e.deliveryDate=g[h].estimatedDeliveryTime,e.deliveryDescription=g[h].name));e.deliveryTypeList=g.map(function(a){return{id:a.id}})}return b.OMN.withFees?e.price=e.buyerSeesPerProduct.amount:e.price=e.pricePerProduct.amount,e.listingId=Number(e.id),e},url:function(){return"/shape/inventory/listings/v2/"+this.get("parkingListingId")}});return c}),define("event-parkingpass-component",["foobunny","component","event-parkingpass-model","event-singlelisting-model","event-parkingpass-view"],function(a,b,c,d,e){"use strict";var f=b.extend({name:"parking",init:function(){var a=this;a.view=new e({el:a.options.element,attributes:a.options.attributes,component:a})},add:function(a){var b,c=this;return this.options.add&&_.isFunction(this.options.add)&&(b=this.options.add.call(this,a),b.done(function(a,b,d){c.view.displayParkingState("added"),c.view.enableButtons()}).fail(function(a,b,d){c.view.delegateError({xhr:a,status:b,statusText:d}),c.view.enableButtons()})),b},remove:function(a){var b,c=this;return this.options.remove&&_.isFunction(this.options.remove)?(b=this.options.remove.call(this,a),b.done(function(a,b,d){c.view.displayParkingState("removed"),c.view.enableButtons()}).fail(function(a,b,d){c.view.delegateError({xhr:a,status:b,statusText:d}),c.view.enableButtons()})):(c.view.displayParkingState("removed"),c.view.enableButtons()),b},more:function(a){this.options.more&&_.isFunction(this.options.more)&&this.options.more.call(this,a)},displayParkingPass:function(a){this.view.displayParkingPass(a)}});return f}),define("event-parkingpass-view",["foobunny","event-parkingpass-model","event-singlelisting-model"],function(a,b,c){"use strict";var d=a.BaseView.extend({template:"parkingpass",events:{"click .parking-button.add":"add","click .parking-button.remove":"remove","click .more-parking":"more"},errorCodes:{"purchase.cart.quantityUnacceptable":"sro","purchase.cart.quantityUnavailable":"sold","purchase.cart.itemNotFound":"sold","purchase.cart.listingOrQuantityUnavailable":"sold","inventory.listings.listingAlreadySold":"sro","inventory.listings.listingExpired":"sold","inventory.listings.invalidListingid":"sold"},initialize:function(a){this.options=a||{},this.TEST=a.attributes.TEST,this.model=new b,this.subModels={singleListingModel:new c({parkingListingId:a.attributes.parkingListingId})},this.displayParkingPass(a.attributes),this.subscribeEvent("parkingpass:error",this.delegateError)},fetchOnInitialize:!1,uiEl:{$parkingWrapper:".parking-component",$parkingSpinner:".parking-spinner",$parkingButtonSpinner:".parking-button-spinner",$parkingInfoWrapper:".parking-info-wrapper",$parkingErrorWrapper:".parking-error-wrapper",$parkingAddButton:".parking-button.add",$parkingRemoveButton:".parking-button.remove"},displayParkingPass:function(a){this.updateModel(a),this.fetchParkingPass()},updateModel:function(a){this.model.setSilent({parkingSelected:a.parkingSelected||!1,parkingInCart:a.parkingInCart||!1,priceType:a.priceType||"listingPrice",qty:a.qty||1,parkingEventId:a.parkingEventId,parkingListingId:a.parkingListingId,isLowest:!a.parkingListingId})},fetchParkingPass:function(){this.model.get("parkingListingId")?this.fetchParkingListingInfo(this.model.get("parkingListingId")):this.model.get("parkingEventId")&&this.fetchParkingEventInfo()},fetchParkingEventInfo:function(){var a,b,c=this;a=this.model.fetch(),a.done(function(a){0!==a.totalListings?(c.fetchParkingListingInfo(c.getParkingListingId(a.listing)),a.totalListings>1&&(b=a.listing,b.shift(),c.model.set("alternateListings",b))):_.isEmpty(c.model.get("exception"))||(c.model.set("exception",{code:"sro"}),c.displayError())})},getParkingListingId:function(a){if(!_.isEmpty(a)&&!_.isEmpty(a[0].seats))return a[0].seats[0].listingId},fetchParkingListingInfo:function(a){var b,c=this;this.subModels.singleListingModel.set("parkingListingId",a),b=this.TEST?this.subModels.singleListingModel.loadMockData():this.subModels.singleListingModel.fetch(),b.done(function(a){c.model.setSilent(a),c.displayParking()}).fail(function(a){c.publishEvent("parkingpass:error",a)})},displayParking:function(){var a=this.model.get("exception")||{},b=this;this.render().done(function(){b.$el.removeClass("hide"),b.model.get("parkingSelected")?b.add():b.model.get("parkingInCart")&&(b.displayParkingState("added"),b.enableButtons()),b.uiEl.$parkingSpinner.addClass("hide"),b.uiEl.$parkingInfoWrapper.removeClass("hide"),b.publishEvent("parkingpass:displayed",b.model),a.code&&(b.uiEl.$parkingWrapper.addClass("parking-error"),b.model.unset("exception"))})},displayError:function(){var a=this;this.render().done(function(){a.uiEl.$parkingWrapper.addClass("parking-error"),a.uiEl.$parkingSpinner.addClass("hide"),a.uiEl.$parkingInfoWrapper.addClass("hide"),a.model.unset("exception")})},displayParkingState:function(a){switch(a){case"added":this.uiEl.$parkingWrapper.addClass("active"),this.publishEvent("parkingpass:add",this.model);break;case"removed":this.uiEl.$parkingWrapper.removeClass("active"),this.publishEvent("parkingpass:remove",this.model)}},disableButtons:function(){this.uiEl.$parkingAddButton.addClass("parking-disabled"),this.uiEl.$parkingRemoveButton.addClass("parking-disabled"),this.uiEl.$parkingButtonSpinner.addClass("button-disabled").removeClass("hide")},enableButtons:function(){var a=this;setTimeout(function(){a.uiEl.$parkingAddButton.removeClass("parking-disabled"),a.uiEl.$parkingRemoveButton.removeClass("parking-disabled"),a.uiEl.$parkingButtonSpinner.removeClass("button-disabled").addClass("hide")},300)},more:function(){this.uiEl.$parkingWrapper.hasClass("active")||(this.options.component.more(this.model),this.publishEvent("parkingpass:more"))},add:function(a){return a&&(a.stopPropagation(),a.preventDefault()),this.disableButtons(),this.$el.find(".parking-error-wrapper").remove(),this.uiEl.$parkingWrapper.hasClass("parking-error")&&this.uiEl.$parkingWrapper.removeClass("parking-error"),this.options.component.add(this.model)},remove:function(a){return a&&(a.stopPropagation(),a.preventDefault()),this.disableButtons(),this.options.component.remove(this.model)},delegateError:function(a){var b;if("undefined"!=typeof a)return b=this.model.get("exception"),_.isObject(b)?void this.handleApiSystemError(b):_.has(a,"responseJSON")?void this.handleInventoryApiError(a.responseJSON):_.has(a,"xhr")?void this.handleCartApiError(a.xhr):void 0},handleApiSystemError:function(a){a.code="error",a.description="SYSTEM ERROR",a.requestId="",a.data={},this.setException({type:"system"},a),this.displayError()},handleInventoryApiError:function(a){this.setException({type:"inventory"},a),"sold"===this.getExceptionCode()?this.fetchAnotherTicket(this.options.attributes.qty):this.displayError()},handleCartApiError:function(a){var b=a;_.has(a,"responseJSON")&&(b=a.responseJSON),this.setException({type:"cart"},b),"sold"===this.getExceptionCode()?this.fetchAnotherTicket(this.options.attributes.qty):this.displayError()},setException:function(a,b){var c=this.errorCodes[b.code]||"error";this.model.set("exception",{type:a,description:b.description,requestId:b.requestId,data:b.data,code:c})},getExceptionCode:function(){var a=this.model.get("exception");if(a)return a.code},fetchAnotherTicket:function(a){var b={},c=this.model.get("alternateListings");b.parkingSelected=!1,b.qty=a,b.isLowest=!1,b.priceType=this.model.get("priceType"),b.parkingEventId=this.model.get("parkingEventId"),_.isEmpty(c)||_.isEmpty(c[0].listingId)?(this.updateModel(b),this.fetchParkingEventInfo()):(b.parkingListingId=c[0].listingId,c.shift(),this.model.set("alternateListings",c),this.updateModel(b),this.fetchParkingListingInfo(b.parkingListingId))}});return d});